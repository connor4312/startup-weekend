/*! Built 13-10-2013 at #SWPNS */
!function(){function a(){this.ox=this.attr("x"),this.oy=this.attr("y")}function b(a,b){var c=this.ox+a,d=this.oy+b;c=Math.min(r-this.attr("width")-10,c),c=Math.max(10,c),d=Math.min(q-this.attr("height")-10,d),d=Math.max(10,d),this.attr({x:c,y:d}),this._moving=!0,this._glow&&(this._glow.remove(),this._glow=void 0)}function c(){d(this,this.selected)}function d(a,b){a._glow&&a._glow.remove(),a._glow=a.glow({color:b?"#21a3c9":"#000000"})}function e(a){a&&(a.selected=!1,d(a,!1),x=null)}function f(a){a.selected=!0,d(a,!0),x=a}function g(a){var b=x._index,c=w.splice(a?b+1:b-1,1)[0];x._index=a?x._index+1:x._index-1,c._index=a?c._index-1:c._index+1,x[a?"insertAfter":"insertBefore"](c),w.splice(c._index,0,c),d(x,x.selected)}function h(){w.length<2||!x||0===x._index||g(!1)}function i(){w.length<2||!x||x._index===w.length-1||g(!0)}function j(d){d._index=w.length,d.click(function(a){a.stopPropagation(),this!==x||this._moving||e(this),this._moving&&(this._moving=!1)}),d.dblclick(function(a){a.stopPropagation(),e(x),f(this)}),d._glow=d.glow(),d.drag(b,a,c),w.push(d)}function k(a){var b=s.rect(200,200,a.width,a.height);b.attr({cursor:"move",stroke:"#FFF","stroke-width":10,fill:"url("+a.url+")"}),b._type="image",b._width=a.width,b._height=a.height,b._url=a.url,j(b)}function l(a){return function(b){t.val(b.replace(/^#(.)\1(.)\2(.)\3$/,"#$1$2$3")),a.color(b),t.css({background:b,color:Raphael.rgb2hsb(b).b<.5?"#FFF":"#000"})}}function m(){var a=s.rect(200,200,200,200),b=t.val();a.attr({fill:b,cursor:"move",stroke:"#FFF","stroke-width":10}),a._type="color",a._hex=b,j(a),v.hide(),o.color("#EEE"),t.css({background:"#FFF",color:"#000"}),t.val("")}var n,o,p=$("#canvas"),q=1240,r=960,s=Raphael(p[0],r,q),t=$("#colorHex"),u=$("#imageUrl"),v=$("#pickerContainer"),w=[],x=null;s.canvas.style.backgroundColor="#f2f2f2",n=document.getElementById("canvas").getAttribute("data-key"),$(s.canvas).click(function(){e(x)}),$("#addColorButton").click(m),$("#moveBackButton").click(h),$("#moveForwardButton").click(i),$("#addImageButton").click(function(){$.ajax({url:"/api/image/upload?board="+n+"&type=url&url="+u.val(),method:"GET",success:k,error:function(){console.log("There was an error")}})}),$("#imageUpload").on("submit",function(a){a.preventDefault(),$(this).ajaxForm({url:"/api/image/upload?board="+n+"&type=upload",method:"POST",success:k,error:function(){console.log("There was an error")}})}),$("#addColor").click(function(){o||(o=Raphael.colorpicker(0,0,$("#left-nav").innerWidth()-1,"#EEE"),document.getElementById("pickerCanvas").appendChild(o.raphael.canvas),o.onchange=l(o),t.val("#eee")),v.show()}),$("#selectColor").click(m),t.keyup(function(){o&&colorWheel.color(t.val())})}(jQuery,Raphael);