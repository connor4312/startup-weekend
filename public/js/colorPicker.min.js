/*! Built 13-10-2013 at #SWPNS */
!function(a){function b(a,b){return 180*(0>a)+180*Math.atan(-b/-a)/c}a.colorpicker=function(a,b,c,e,f){return new d(a,b,c,e,f)},a.fn.colorPickerIcon=function(a,b,d){for(var e=2*c*d/Math.min(d/8,4),f=c/2-1.5*(2*c/e),g=["M",a,b-d,"A",d,d,0,0,1,d*Math.cos(f)+a,b-d*Math.sin(f),"L",a,b,"z"].join(),h=0;e>h;h++)this.path(g).attr({stroke:"none",fill:"hsb("+(e-h)*(255/e)/255+", 1, 1)",transform:"r"+[90+360/e*h,a,b]});return this.circle(a,b,d).attr({fill:"r#fff-#fff","fill-opacity":0,"stroke-width":Math.round(.03*d),stroke:"#fff"})};var c=Math.PI,d=function(b,c,d,e,f){d=d||200;var g=3*d/200,h=d/200,i=1.6180339887,j=d/20,k=d/2,l=2*d/200,m=d+2*j+3*l,n=this,o=f?a(f,d,m):a(b,c,d,m);1>h&&(h=1),1>g&&(g=1),o.colorPickerIcon(k,k,k-l),n.cursor=o.set(),n.cursor.push(o.circle(k,k,j/2).attr({stroke:"#000",opacity:.5,"stroke-width":g})),n.cursor.push(n.cursor[0].clone().attr({stroke:"#fff",opacity:1,"stroke-width":h})),n.disc=o.circle(k,k,k-l).attr({fill:"#000","fill-opacity":0,stroke:"none",cursor:"crosshair"});var p=n.disc.node.style;p.unselectable="on",p.MozUserSelect="none",p.WebkitUserSelect="none";var q=2*j+2;n.brect=o.rect(l+q/i/2,d+2*l,d-2*l-q/i,q-2*l).attr({stroke:"#fff",fill:"180-#fff-#000"}),n.cursorb=o.set(),n.cursorb.push(o.rect(d-l-q/i,d+l,~~(q/i),q,g).attr({stroke:"#000",opacity:.5,"stroke-width":g})),n.cursorb.push(n.cursorb[0].clone().attr({stroke:"#fff",opacity:1,"stroke-width":h})),n.btop=n.brect.clone().attr({stroke:"#000",fill:"#000",opacity:0}),p=n.btop.node.style,p.unselectable="on",p.MozUserSelect="none",p.WebkitUserSelect="none",n.bwidth=~~(q/i)/2,n.minx=l+n.bwidth,n.maxx=d-q/i-l+n.bwidth,n.H=n.S=n.B=1,n.padding=l,n.raphael=o,n.size2=k,n.size20=j,n.x=b,n.y=c,n.disc.drag(function(a,b,c,d){n.docOnMove(a,b,c,d)},function(a,b){n.hsOnTheMove=!0,n.setHS(a-n.x,b-n.y)},function(){n.hsOnTheMove=!1}),n.btop.drag(function(a,b,c,d){n.docOnMove(a,b,c,d)},function(a){n.bOnTheMove=!0,n.setB(a-n.x)},function(){n.bOnTheMove=!1}),n.color(e||"#fff"),this.onchanged&&this.onchanged(this.color())};d.prototype.setB=function(a){a<this.minx&&(a=this.minx),a>this.maxx&&(a=this.maxx),this.cursorb.attr({x:a-this.bwidth}),this.B=(a-this.minx)/(this.maxx-this.minx),this.onchange&&this.onchange(this.color())},d.prototype.setHS=function(a,d){var e=a-this.size2,f=d-this.size2,g=this.size2-this.size20/2-this.padding,h=b(e,f),i=h*c/180;isNaN(h)&&(h=0),e*e+f*f>g*g&&(a=g*Math.cos(i)+this.size2,d=g*Math.sin(i)+this.size2),this.cursor.attr({cx:a,cy:d}),this.H=(1-h/360)%1,this.S=Math.min((e*e+f*f)/g/g,1),this.brect.attr({fill:"180-hsb("+[this.H,this.S]+",1)-#000"}),this.onchange&&this.onchange(this.color())},d.prototype.docOnMove=function(a,b,c,d){this.hsOnTheMove&&this.setHS(c-this.x,d-this.y),this.bOnTheMove&&this.setB(c-this.x)},d.prototype.remove=function(){this.raphael.remove(),this.color=function(){return!1}},d.prototype.color=function(b){if(b){b=a.getRGB(b),b.hex,b=a.rgb2hsb(b.r,b.g,b.b),d=360*b.h,this.H=b.h,this.S=b.s,this.B=b.b,this.cursorb.attr({x:this.B*(this.maxx-this.minx)+this.minx-this.bwidth}),this.brect.attr({fill:"180-hsb("+[this.H,this.S]+",1)-#000"});var d=360*(1-this.H),e=d*c/180,f=(this.size2-this.size20/2-this.padding)*this.S,g=Math.cos(e)*f+this.size2,h=Math.sin(e)*f+this.size2;return this.cursor.attr({cx:g,cy:h}),this}return a.hsb2rgb(this.H,this.S,this.B).hex}}(window.Raphael);